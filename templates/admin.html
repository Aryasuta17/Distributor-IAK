<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - PT IKAN TERBANG MAKMUR SEJAHTERA Tbk</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/components.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/responsive.css') }}"
    />

    <style>
      /* Analytics Grid */
      .analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 24px;
        margin-bottom: 24px;
      }

      .analytics-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        border: 1px solid #e5e7eb;
        transition: all 0.3s ease;
      }

      .analytics-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
      }

      .analytics-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
      }

      .analytics-card-title {
        font-size: 14px;
        font-weight: 600;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .analytics-card-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }

      .analytics-card-icon.primary {
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
      }

      .analytics-card-icon.success {
        background: #d1fae5;
        color: #10b981;
      }

      .analytics-card-icon.warning {
        background: #fef3c7;
        color: #f59e0b;
      }

      .analytics-card-icon.danger {
        background: #fee2e2;
        color: #ef4444;
      }

      .analytics-value {
        font-size: 36px;
        font-weight: 800;
        color: #1e293b;
        margin-bottom: 8px;
      }

      .analytics-label {
        font-size: 14px;
        color: #64748b;
        margin-bottom: 16px;
      }

      .analytics-trend {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        font-weight: 600;
      }

      .analytics-trend.up {
        color: #10b981;
      }

      .analytics-trend.down {
        color: #ef4444;
      }

      .chart-container-analytics {
        background: white;
        border-radius: 16px;
        padding: 28px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        border: 1px solid #e5e7eb;
        margin-bottom: 24px;
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }

      .chart-title {
        font-size: 18px;
        font-weight: 600;
        color: #1e293b;
      }

      .route-list {
        display: grid;
        gap: 12px;
      }

      .route-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        background: #f9fafb;
        border-radius: 10px;
        transition: all 0.2s;
      }

      .route-item:hover {
        background: #f3f4f6;
      }

      .route-info {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .route-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      .route-text {
        font-weight: 600;
        color: #1e293b;
        font-size: 14px;
      }

      .route-count {
        font-size: 20px;
        font-weight: 700;
        color: #007bff;
      }

      .performance-metric {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 0;
        border-bottom: 1px solid #e5e7eb;
      }

      .performance-metric:last-child {
        border-bottom: none;
      }

      .metric-label {
        font-size: 14px;
        color: #64748b;
        font-weight: 500;
      }

      .metric-value {
        font-size: 18px;
        font-weight: 700;
        color: #1e293b;
      }

      .progress-bar-container {
        width: 100%;
        height: 8px;
        background: #e5e7eb;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 8px;
      }

      .progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #007bff, #0056b3);
        border-radius: 4px;
        transition: width 1s ease;
      }

      /* Tracking Section Styles */
      .tracking-section {
        max-width: 1200px;
        margin: 0 auto;
      }

      .tracking-layout {
        display: grid;
        grid-template-columns: 420px 1fr;
        gap: 24px;
        margin-top: 24px;
      }

      .tracking-box-wrapper {
        perspective: 1500px;
      }

      .tracking-info-box {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        color: white;
        padding: 32px;
        border-radius: 16px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        min-height: 450px;
        position: relative;
        overflow: hidden;
        transition: transform 0.4s ease;
      }

      .tracking-info-box:hover {
        transform: translateY(-4px);
      }

      .tracking-info-box::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        animation: shimmer 3s infinite;
      }

      @keyframes shimmer {
        0%,
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 0;
        }
        50% {
          transform: translate(0%, 0%) scale(1.5);
          opacity: 1;
        }
      }

      .tracking-info-box.empty-state {
        background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
      }

      .empty-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        text-align: center;
        opacity: 0.7;
        position: relative;
        z-index: 1;
      }

      .empty-placeholder i {
        font-size: 64px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .empty-placeholder p {
        font-size: 14px;
        margin: 0;
        line-height: 1.6;
      }

      .tracking-data {
        position: relative;
        z-index: 1;
      }

      .resi-header-track {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      }

      .resi-number-track {
        font-size: 24px;
        font-weight: 700;
        margin-top: 8px;
        word-break: break-all;
      }

      .resi-label {
        font-size: 12px;
        opacity: 0.85;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .resi-icon-track {
        font-size: 48px;
        opacity: 0.8;
      }

      .detail-grid {
        display: grid;
        gap: 12px;
      }

      .detail-box {
        background: rgba(255, 255, 255, 0.15);
        padding: 16px;
        border-radius: 10px;
        backdrop-filter: blur(10px);
      }

      .detail-box-label {
        font-size: 11px;
        opacity: 0.85;
        margin-bottom: 6px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .detail-box-value {
        font-size: 16px;
        font-weight: 600;
      }

      .timeline-wrapper {
        background: white;
        border-radius: 16px;
        padding: 28px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
        border: 1px solid #e5e7eb;
      }

      .timeline-header {
        font-size: 18px;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .timeline-list {
        display: flex;
        flex-direction: column;
        gap: 0;
      }

      .timeline-step {
        display: flex;
        gap: 16px;
        position: relative;
        padding-bottom: 24px;
      }

      .timeline-step:last-child {
        padding-bottom: 0;
      }

      .timeline-step:not(:last-child)::after {
        content: "";
        position: absolute;
        left: 19px;
        top: 42px;
        width: 2px;
        height: calc(100% - 22px);
        background: #e2e8f0;
      }

      .timeline-marker {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #007bff;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        z-index: 1;
        position: relative;
        box-shadow: 0 2px 8px rgba(20, 184, 166, 0.3);
      }

      .timeline-marker.inactive {
        background: #e2e8f0;
        color: #94a3b8;
        box-shadow: none;
      }

      .timeline-text {
        flex: 1;
        padding-top: 8px;
      }

      .timeline-status-text {
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 4px;
        line-height: 1.4;
      }

      .timeline-status-text.current {
        color: #007bff;
      }

      .timeline-date-text {
        font-size: 13px;
        color: #64748b;
      }

      .timeline-empty {
        text-align: center;
        padding: 80px 20px;
        color: #94a3b8;
      }

      .timeline-empty i {
        font-size: 56px;
        opacity: 0.3;
        margin-bottom: 16px;
        display: block;
      }

      .timeline-empty p {
        margin: 0;
        font-size: 14px;
      }

      .skeleton-loader {
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.1) 25%,
          rgba(255, 255, 255, 0.2) 50%,
          rgba(255, 255, 255, 0.1) 75%
        );
        background-size: 200% 100%;
        animation: skeleton-loading 1.5s infinite;
        border-radius: 8px;
        height: 20px;
        margin-bottom: 12px;
      }

      @keyframes skeleton-loading {
        0% {
          background-position: -200% 0;
        }
        100% {
          background-position: 200% 0;
        }
      }

      .skeleton-loader.title {
        height: 28px;
        width: 70%;
        margin-bottom: 16px;
      }

      .skeleton-loader.text {
        height: 18px;
        width: 50%;
      }

      @media (max-width: 1024px) {
        .tracking-layout {
          grid-template-columns: 1fr;
        }

        .tracking-info-box {
          min-height: auto;
        }

        .analytics-grid {
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
      }

      @media (max-width: 768px) {
        .tracking-section {
          padding: 0;
        }

        .tracking-info-box {
          padding: 24px;
        }

        .resi-header-track {
          flex-direction: column;
          gap: 16px;
        }

        .resi-icon-track {
          font-size: 36px;
        }

        .timeline-wrapper {
          padding: 20px;
        }

        .analytics-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="header-top">
        <div class="logo">
          <i class="fas fa-ship"></i>
          <span class="logo-text">PT IKAN TERBANG MAKMUR SEJAHTERA Tbk</span>
        </div>

        <div class="header-actions">
          <div class="user-profile">
            <div class="avatar">
              {{ session.admin_name[:2].upper() if session.admin_name else 'AD'
              }}
            </div>
            <div class="user-info">
              <span class="user-name">{{ session.admin_name or 'Admin' }}</span>
              <span class="user-role">Administrator</span>
            </div>
          </div>

          <form action="/logout" method="POST" style="display: inline">
            <button
              type="submit"
              class="btn btn-danger"
              style="padding: 8px 16px"
            >
              <i class="fas fa-sign-out-alt"></i> Logout
            </button>
          </form>
        </div>
      </div>

      <nav class="tab-navigation">
        <button class="tab-item active" data-tab="dashboard">
          <i class="fas fa-chart-line"></i>
          <span>Dashboard</span>
        </button>
        <button class="tab-item" data-tab="cek-resi">
          <i class="fas fa-search"></i>
          <span>Cek Resi</span>
        </button>
        <button class="tab-item" data-tab="kelola-pesanan">
          <i class="fas fa-box"></i>
          <span>Kelola Pesanan</span>
        </button>
        <button class="tab-item" data-tab="analytics">
          <i class="fas fa-chart-pie"></i>
          <span>Analytics</span>
        </button>
        <button class="tab-item" data-tab="team">
          <i class="fas fa-users"></i>
          <span>Team</span>
        </button>
      </nav>
    </header>

    <main class="main-content">
      <!-- TAB 1: DASHBOARD -->
      <section id="tab-dashboard" class="tab-content active">
        <div class="content-header">
          <div>
            <h1 class="page-title">Dashboard</h1>
            <p class="page-subtitle">
              Selamat datang! Ringkasan pengiriman hari ini
            </p>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card primary">
            <div class="stat-icon">
              <i class="fas fa-box"></i>
            </div>
            <div class="stat-content">
              <span class="stat-label">Total Pengiriman</span>
              <h2 class="stat-value" id="stat-total">-</h2>
              <p class="stat-change" id="stat-change-total">
                <i class="fas fa-spinner fa-spin"></i> Loading...
              </p>
            </div>
          </div>

          <div class="stat-card warning">
            <div class="stat-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
              <span class="stat-label">Dalam Proses</span>
              <h2 class="stat-value" id="stat-proses">-</h2>
              <p class="stat-change" id="stat-change-proses">
                <i class="fas fa-spinner fa-spin"></i> Loading...
              </p>
            </div>
          </div>

          <div class="stat-card info">
            <div class="stat-icon">
              <i class="fas fa-truck"></i>
            </div>
            <div class="stat-content">
              <span class="stat-label">Sedang Dikirim</span>
              <h2 class="stat-value" id="stat-kirim">-</h2>
              <p class="stat-change" id="stat-change-kirim">
                <i class="fas fa-spinner fa-spin"></i> Loading...
              </p>
            </div>
          </div>

          <div class="stat-card success">
            <div class="stat-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
              <span class="stat-label">Selesai</span>
              <h2 class="stat-value" id="stat-selesai">-</h2>
              <p class="stat-change" id="stat-change-selesai">
                <i class="fas fa-spinner fa-spin"></i> Loading...
              </p>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Statistik 6 Bulan Terakhir</h3>
            <div class="card-actions">
              <select class="select-sm" id="chart-type">
                <option value="bar">Bar Chart</option>
                <option value="line">Line Chart</option>
              </select>
            </div>
          </div>
          <div class="card-body">
            <canvas id="shipmentChart"></canvas>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Pesanan Terbaru</h3>
            <button
              class="btn btn-sm btn-primary"
              onclick="switchTab('kelola-pesanan')"
            >
              Lihat Semua <i class="fas fa-arrow-right"></i>
            </button>
          </div>
          <div class="card-body">
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>No Resi</th>
                    <th>Pembeli</th>
                    <th>Rute</th>
                    <th>Status</th>
                    <th>Tanggal</th>
                    <th>Harga</th>
                  </tr>
                </thead>
                <tbody id="recent-orders-tbody">
                  <tr>
                    <td colspan="6" class="text-center">
                      <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Memuat data...</p>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- TAB 2: CEK RESI -->
      <section id="tab-cek-resi" class="tab-content">
        <div class="content-header">
          <div>
            <h1 class="page-title">Cek Resi Pengiriman</h1>
            <p class="page-subtitle">
              Lacak paket dengan memasukkan nomor resi
            </p>
          </div>
        </div>

        <div class="tracking-section">
          <div class="card">
            <div class="card-body">
              <form id="form-cek-resi" class="search-form">
                <div class="search-input-group">
                  <i class="fas fa-search"></i>
                  <input
                    type="text"
                    id="input-resi"
                    placeholder="Masukkan nomor resi (contoh: RESI-20250104-ABC123)"
                    required
                  />
                  <button type="submit" class="btn btn-primary">
                    Cek Resi
                  </button>
                </div>
              </form>

              <div
                id="tracking-error"
                class="alert alert-danger"
                style="display: none"
              ></div>

              <div class="tracking-layout" id="tracking-layout">
                <div class="tracking-box-wrapper">
                  <div
                    class="tracking-info-box empty-state"
                    id="tracking-info-box"
                  >
                    <div class="empty-placeholder" id="empty-placeholder">
                      <i class="fas fa-box-open"></i>
                      <p>
                        Masukkan nomor resi untuk<br />melihat detail pengiriman
                      </p>
                    </div>
                  </div>
                </div>

                <div class="timeline-wrapper">
                  <div class="timeline-header">
                    <i class="fas fa-route"></i>
                    Status Pengiriman
                  </div>
                  <div class="timeline-list" id="timeline-list">
                    <div class="timeline-empty">
                      <i class="fas fa-clock"></i>
                      <p>Timeline pengiriman akan muncul di sini</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- TAB 3: KELOLA PESANAN -->
      <section id="tab-kelola-pesanan" class="tab-content">
        <div class="content-header">
          <div>
            <h1 class="page-title">Kelola Pesanan</h1>
            <p class="page-subtitle">Manajemen semua pesanan pengiriman</p>
          </div>
          <button
            class="btn btn-primary"
            onclick="openModal('modalTambahPesanan')"
          >
            <i class="fas fa-plus"></i>
            Tambah Pesanan
          </button>
        </div>

        <div class="sub-tabs">
          <button class="sub-tab-item active" data-subtab="aktif">
            <i class="fas fa-clock"></i>
            Pesanan Aktif
          </button>
          <button class="sub-tab-item" data-subtab="selesai">
            <i class="fas fa-check-circle"></i>
            Histori Selesai
          </button>
        </div>

        <div id="subtab-aktif" class="sub-tab-content active">
          <div class="card">
            <div class="card-header">
              <div class="search-filter-group">
                <div class="search-box">
                  <i class="fas fa-search"></i>
                  <input
                    type="text"
                    id="search-aktif"
                    placeholder="Cari pesanan..."
                  />
                </div>
                <select class="select-sm" id="filter-status-aktif">
                  <option value="">Semua Status</option>
                </select>
              </div>
            </div>
            <div class="card-body">
              <div class="table-container">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>No</th>
                      <th>No Resi</th>
                      <th>Pembeli</th>
                      <th>Barang</th>
                      <th>Qty</th>
                      <th>Rute</th>
                      <th>Harga</th>
                      <th>ETA</th>
                      <th>Status</th>
                      <th>Aksi</th>
                    </tr>
                  </thead>
                  <tbody id="table-aktif-tbody">
                    <tr>
                      <td colspan="9" class="text-center">
                        <div class="loading-state">
                          <i class="fas fa-spinner fa-spin"></i>
                          <p>Memuat data...</p>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div id="subtab-selesai" class="sub-tab-content">
          <div class="card">
            <div class="card-header">
              <div class="search-filter-group">
                <div class="search-box">
                  <i class="fas fa-search"></i>
                  <input
                    type="text"
                    id="search-selesai"
                    placeholder="Cari pesanan..."
                  />
                </div>
              </div>
            </div>
            <div class="card-body">
              <div class="table-container">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>No</th>
                      <th>No Resi</th>
                      <th>Pembeli</th>
                      <th>Barang</th>
                      <th>Qty</th>
                      <th>Rute</th>
                      <th>Harga</th>
                      <th>ETA</th>
                      <th>Tanggal</th>
                    </tr>
                  </thead>
                  <tbody id="table-selesai-tbody">
                    <tr>
                      <td colspan="8" class="text-center">
                        <div class="loading-state">
                          <i class="fas fa-spinner fa-spin"></i>
                          <p>Memuat data...</p>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- TAB 4: ANALYTICS (NEW) -->
      <section id="tab-analytics" class="tab-content">
        <div class="content-header">
          <div>
            <h1 class="page-title">Analytics</h1>
            <p class="page-subtitle">Analisis mendalam performa pengiriman</p>
          </div>
        </div>

        <!-- Key Metrics -->
        <div class="analytics-grid">
          <div class="analytics-card">
            <div class="analytics-card-header">
              <div>
                <div class="analytics-card-title">Total Revenue</div>
              </div>
              <div class="analytics-card-icon primary">
                <i class="fas fa-dollar-sign"></i>
              </div>
            </div>
            <div class="analytics-value" id="total-revenue">Rp 0</div>
            <div class="analytics-label">Total pendapatan dari pengiriman</div>
            <div class="analytics-trend up" id="revenue-trend">
              <i class="fas fa-arrow-up"></i>
              <span>Loading...</span>
            </div>
          </div>

          <div class="analytics-card">
            <div class="analytics-card-header">
              <div>
                <div class="analytics-card-title">Avg Delivery Time</div>
              </div>
              <div class="analytics-card-icon success">
                <i class="fas fa-clock"></i>
              </div>
            </div>
            <div class="analytics-value" id="avg-delivery">2 hari</div>
            <div class="analytics-label">Rata-rata waktu pengiriman</div>
            <div class="analytics-trend up" id="delivery-trend">
              <i class="fas fa-arrow-down"></i>
              <span>Loading...</span>
            </div>
          </div>

          <div class="analytics-card">
            <div class="analytics-card-header">
              <div>
                <div class="analytics-card-title">Success Rate</div>
              </div>
              <div class="analytics-card-icon warning">
                <i class="fas fa-percentage"></i>
              </div>
            </div>
            <div class="analytics-value" id="success-rate">0%</div>
            <div class="analytics-label">Tingkat keberhasilan pengiriman</div>
            <div class="analytics-trend up" id="success-trend">
              <i class="fas fa-arrow-up"></i>
              <span>Loading...</span>
            </div>
          </div>

          <div class="analytics-card">
            <div class="analytics-card-header">
              <div>
                <div class="analytics-card-title">Active Routes</div>
              </div>
              <div class="analytics-card-icon danger">
                <i class="fas fa-route"></i>
              </div>
            </div>
            <div class="analytics-value" id="active-routes">0</div>
            <div class="analytics-label">Rute pengiriman aktif</div>
            <div class="analytics-trend up" id="routes-trend">
              <i class="fas fa-minus"></i>
              <span>Loading...</span>
            </div>
          </div>
        </div>

        <!-- Charts Row -->
        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
          "
        >
          <!-- Revenue Chart -->
          <div class="chart-container-analytics">
            <div class="chart-header">
              <h3 class="chart-title">Revenue Trend</h3>
            </div>
            <canvas id="revenueChart"></canvas>
          </div>

          <!-- Status Distribution -->
          <div class="chart-container-analytics">
            <div class="chart-header">
              <h3 class="chart-title">Status Distribution</h3>
            </div>
            <canvas id="statusChart"></canvas>
          </div>
        </div>

        <!-- Bottom Row -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px">
          <!-- Top Routes -->
          <div class="chart-container-analytics">
            <div class="chart-header">
              <h3 class="chart-title">
                <i class="fas fa-map-marked-alt"></i>
                Top Routes
              </h3>
            </div>
            <div class="route-list" id="top-routes">
              <div class="loading-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading routes...</p>
              </div>
            </div>
          </div>

          <!-- Monthly Summary -->
          <div class="chart-container-analytics">
            <div class="chart-header">
              <h3 class="chart-title">
                <i class="fas fa-calendar-check"></i>
                Ringkasan Bulan Ini
              </h3>
            </div>
            <div id="monthly-summary">
              <div class="performance-metric">
                <span class="metric-label">Total Pengiriman</span>
                <span class="metric-value" id="monthly-total">0</span>
              </div>
              <div class="performance-metric">
                <span class="metric-label">Total Revenue</span>
                <span class="metric-value" id="monthly-revenue">Rp 0</span>
              </div>
              <div class="performance-metric">
                <span class="metric-label">Pesanan Selesai</span>
                <span class="metric-value" id="monthly-completed">0</span>
              </div>
              <div class="performance-metric">
                <span class="metric-label">Completion Rate</span>
                <span class="metric-value" id="monthly-completion-rate"
                  >0%</span
                >
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- TAB 5: TEAM -->
      <section id="tab-team" class="tab-content">
        <div class="content-header">
          <div>
            <h1 class="page-title">Team Management</h1>
            <p class="page-subtitle">Kelola tim dan informasi anggota</p>
          </div>
        </div>

        <div class="team-grid">
          <div class="team-card">
            <div class="team-avatar">
              <i class="fas fa-user"></i>
            </div>
            <h3>Kelompok D</h3>
            <p class="team-role">Modul Distributor</p>
            <div class="team-info">
              <p><strong>Perusahaan:</strong> PT IKAN TERBANG MAKMUR SEJAHTERA Tbk</p>
              <p><strong>Project:</strong> UTS Integrasi Aplikasi</p>
              <p><strong>Sistem:</strong> Supply Chain Management</p>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <h4>Informasi Sistem</h4>
              <div class="system-info">
                <div class="info-item">
                  <i class="fas fa-server"></i>
                  <div>
                    <span>Backend</span>
                    <strong>Flask + Firebase</strong>
                  </div>
                </div>
                <div class="info-item">
                  <i class="fas fa-database"></i>
                  <div>
                    <span>Database</span>
                    <strong>Firestore</strong>
                  </div>
                </div>
                <div class="info-item">
                  <i class="fas fa-code"></i>
                  <div>
                    <span>Frontend</span>
                    <strong>HTML + CSS + JavaScript</strong>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- MODALS -->
    <div id="modalTambahPesanan" class="modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title">Tambah Pesanan Baru</h3>
            <button
              class="modal-close"
              onclick="closeModal('modalTambahPesanan')"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
          <form id="form-tambah-pesanan" class="modal-body">
            <div class="form-group">
              <label>ID Pembeli</label>
              <input
                type="text"
                name="id_pembeli"
                class="form-control"
                required
              />
            </div>
            <div class="form-group">
              <label>Nama Barang</label>
              <input
                type="text"
                name="nama_barang"
                class="form-control"
                required
              />
            </div>
            <div class="form-group">
              <label>Kuantitas (Kg)</label>
              <input
                type="number"
                name="kuantitas"
                class="form-control"
                required
                min="1"
              />
            </div>
            <div class="form-group">
              <label>Asal Pengirim</label>
              <select name="asal_pengirim" class="form-control" required>
                <option value="">Pilih Asal</option>
                <option value="malang">Malang</option>
                <option value="gresik">Gresik</option>
              </select>
            </div>
            <div class="form-group">
              <label>Tujuan</label>
              <select name="tujuan" class="form-control" required>
                <option value="">Pilih Tujuan</option>
                <option value="surabaya">Surabaya</option>
                <option value="banyuwangi">Banyuwangi</option>
              </select>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="closeModal('modalTambahPesanan')"
              >
                Batal
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i>
                Simpan
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="modalEditStatus" class="modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title">Update Status Pesanan</h3>
            <button class="modal-close" onclick="closeModal('modalEditStatus')">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <form id="form-edit-status" class="modal-body">
            <input type="hidden" id="edit-doc-id" />
            <div class="form-group">
              <label>Status Baru</label>
              <select id="edit-status" class="form-control" required></select>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="closeModal('modalEditStatus')"
              >
                Batal
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-check"></i>
                Update
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="toast" class="toast"></div>

    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/api.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chart.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    <!-- Tracking Resi Functionality -->
    <script>
      const STATUS_LIST_TRACKING = [
        { text: "Pesanan anda sedang kami proses", icon: "fa-clipboard-check" },
        { text: "Kurir berangkat mengambil paket", icon: "fa-motorcycle" },
        { text: "Kurir mengirim paket", icon: "fa-truck-ramp-box" },
        { text: "Paket telah sampai di Gudang Sortir", icon: "fa-warehouse" },
        { text: "Paket Keluar dari Gudang Sortir", icon: "fa-dolly" },
        { text: "Kurir menuju ke lokasi anda", icon: "fa-truck-fast" },
        { text: "Paket telah sampai di lokasi anda", icon: "fa-house" },
        { text: "Pesanan Selesai", icon: "fa-circle-check" },
      ];

      const trackingInfoBox = document.getElementById("tracking-info-box");
      const timelineList = document.getElementById("timeline-list");
      const trackingError = document.getElementById("tracking-error");
      const formCekResi = document.getElementById("form-cek-resi");
      const inputResi = document.getElementById("input-resi");

      formCekResi.addEventListener("submit", async (e) => {
        e.preventDefault();
        const resiNumber = inputResi.value.trim();

        if (!resiNumber) {
          showTrackingError("Mohon masukkan nomor resi");
          return;
        }

        hideTrackingError();
        showLoadingState();

        try {
          const response = await fetch(
            `/status?no_resi=${encodeURIComponent(resiNumber)}`
          );
          const data = await response.json();

          if (data.status === "success") {
            displayTrackingResult(data);
          } else {
            throw new Error(data.message || "Nomor resi tidak ditemukan");
          }
        } catch (error) {
          showTrackingError(error.message);
          resetToEmptyState();
        }
      });

      function showLoadingState() {
        trackingInfoBox.classList.add("empty-state");
        trackingInfoBox.innerHTML = `
                <div style="padding: 20px; position: relative; z-index: 1;">
                    <div class="skeleton-loader title"></div>
                    <div class="skeleton-loader text" style="margin-bottom: 20px"></div>
                    <div class="skeleton-loader" style="margin-bottom: 12px"></div>
                    <div class="skeleton-loader" style="margin-bottom: 12px"></div>
                    <div class="skeleton-loader" style="width: 80%"></div>
                </div>
            `;

        timelineList.innerHTML = `
                <div style="padding: 20px;">
                    <div class="skeleton-loader" style="margin-bottom: 15px; height: 40px;"></div>
                    <div class="skeleton-loader" style="margin-bottom: 15px; height: 40px;"></div>
                    <div class="skeleton-loader" style="width: 70%; height: 40px;"></div>
                </div>
            `;
      }

      function displayTrackingResult(data) {
        trackingInfoBox.classList.remove("empty-state");

        const asal =
          data.asal_pengirim || data.asal || data.route_origin || "-";
        const tujuan =
          data.tujuan ||
          data.tujuan_retail ||
          data.route_dest ||
          data.destination ||
          "-";
        const harga = Number(data.harga_pengiriman || 0);
        const distributor = data.distributor_name || "-";
        const etaText = data.eta_text || "-";
        const statusNow = data.status_pengiriman || "-";

        trackingInfoBox.innerHTML = `
                <div class="tracking-data">
                    <div class="resi-header-track">
                        <div>
                            <div class="resi-label">Nomor Resi</div>
                            <div class="resi-number-track">${
                              data.no_resi || "-"
                            }</div>
                        </div>
                        <div class="resi-icon-track">
                            <i class="fas fa-box"></i>
                        </div>
                    </div>
                    <div class="detail-grid">
                        <div class="detail-box">
                            <div class="detail-box-label">Asal Pengirim</div>
                            <div class="detail-box-value">${capitalize(
                              asal
                            )}</div>
                        </div>
                        <div class="detail-box">
                            <div class="detail-box-label">Tujuan</div>
                            <div class="detail-box-value">${capitalize(
                              tujuan
                            )}</div>
                        </div>
                        <div class="detail-box">
                            <div class="detail-box-label">Harga Pengiriman</div>
                            <div class="detail-box-value">Rp ${harga.toLocaleString(
                              "id-ID"
                            )}</div>
                        </div>
                        <div class="detail-box">
                            <div class="detail-box-label">Estimasi Tiba</div>
                            <div class="detail-box-value">${etaText}</div>
                        </div>
                        <div class="detail-box">
                            <div class="detail-box-label">Distributor</div>
                            <div class="detail-box-value" style="font-size: 14px;">${distributor}</div>
                        </div>
                    </div>
                </div>
            `;

        const currentStatusIndex = STATUS_LIST_TRACKING.findIndex(
          (s) => s.text === statusNow
        );
        timelineList.innerHTML = "";

        STATUS_LIST_TRACKING.forEach((status, index) => {
          const isActive =
            index <= currentStatusIndex && currentStatusIndex >= 0;
          const isCurrent = index === currentStatusIndex;

          const step = document.createElement("div");
          step.className = "timeline-step";
          step.innerHTML = `
                    <div class="timeline-marker ${isActive ? "" : "inactive"}">
                        <i class="fas ${status.icon}"></i>
                    </div>
                    <div class="timeline-text">
                        <div class="timeline-status-text ${
                          isCurrent ? "current" : ""
                        }">
                            ${status.text}
                            ${
                              isCurrent
                                ? '<i class="fas fa-circle" style="font-size: 6px; margin-left: 8px;"></i>'
                                : ""
                            }
                        </div>
                        ${
                          isActive
                            ? `<div class="timeline-date-text">${
                                data.tanggal_pembelian || "-"
                              }</div>`
                            : ""
                        }
                    </div>
                `;
          timelineList.appendChild(step);
        });
      }

      function resetToEmptyState() {
        trackingInfoBox.classList.add("empty-state");
        trackingInfoBox.innerHTML = `
                <div class="empty-placeholder">
                    <i class="fas fa-box-open"></i>
                    <p>Masukkan nomor resi untuk<br>melihat detail pengiriman</p>
                </div>
            `;

        timelineList.innerHTML = `
                <div class="timeline-empty">
                    <i class="fas fa-clock"></i>
                    <p>Timeline pengiriman akan muncul di sini</p>
                </div>
            `;
      }

      function showTrackingError(message) {
        trackingError.textContent = message;
        trackingError.style.display = "block";
        setTimeout(() => hideTrackingError(), 5000);
      }

      function hideTrackingError() {
        trackingError.style.display = "none";
      }

      function capitalize(str) {
        if (!str || typeof str !== "string") return "-";
        return str.charAt(0).toUpperCase() + str.slice(1);
      }
    </script>
  </body>
</html>
